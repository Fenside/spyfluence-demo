$(function(){$("#dropzone-demo").dropzone({parallelUploads:2,maxFilesize:5e4,filesizeBase:1e3,addRemoveLinks:!0}),Dropzone.prototype.uploadFiles=function(e){for(var o=6,s=60,i=100,n=1e5,l=Math.round(Math.random()),r=this,t=0;t<e.length;t++)for(var f=e[t],a=Math.round(Math.min(s,Math.max(o,f.size/n))),u=0;u<a;u++){var d=i*(u+1);setTimeout(function(e,o,s){return function(){e.upload={progress:100*(s+1)/o,total:e.size,bytesSent:(s+1)*e.size/o},r.emit("uploadprogress",e,e.upload.progress,e.upload.bytesSent),100==e.upload.progress&&(l?(e.status=Dropzone.SUCCESS,r.emit("success",e,"success",null)):(e.status=Dropzone.ERROR,r.emit("error",e,"Some upload error",null)),r.emit("complete",e),r.processQueue())}}(f,a,u),d)}}}),$(function(){function s(e){if(!e)return"0 kB";var o=["bytes","kB","MB","GB","TB","PB"],s=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,s)).toFixed(2)+" "+o[s]}function o(e){function o(e){return 1<e?"s":""}var s=Math.floor(e/31536e3);if(s)return s+" year"+o(s);var i=Math.floor((e%=31536e3)/86400);if(i)return i+" day"+o(i);var n=Math.floor((e%=86400)/3600);if(n)return n+" hour"+o(n);var l=Math.floor((e%=3600)/60);if(l)return l+" minute"+o(l);var r=e%60;return r+" second"+o(r)}var i=new Flow({target:"http://posttestserver.com/post.php",permanentErrors:[500,501],maxChunkRetries:1,chunkRetryInterval:5e3,simultaneousUploads:1});i.support?($(".flow-drop").show(),i.assignDrop($(".flow-drop")[0]),i.assignBrowse($(".flow-browse")[0]),i.assignBrowse($(".flow-browse-folder")[0],!0),i.assignBrowse($(".flow-browse-image")[0],!1,!1,{accept:"image/*"}),i.on("fileAdded",function(e){$(".flow-progress, .flow-list").removeClass("d-none"),$(".flow-list").append('<li class="flow-file list-group-item flow-file-'+e.uniqueIdentifier+'"><div class="flow-progress media"><div class="media-body"><div><strong class="flow-file-name"></strong> - <em class="flow-file-progress"><span class="text-muted">Waiting...</span></em></div><div><small class="flow-file-size text-muted"></small></div></div><div class="ml-3 align-self-center"><button type="button" class="flow-file-download btn btn-sm icon-btn btn-outline-primary"><i class="ion ion-md-download"></i></button><button type="button" class="flow-file-pause btn btn-sm icon-btn btn-outline-warning"><i class="ion ion-md-pause"></i></button> <button type="button" class="flow-file-resume btn btn-sm icon-btn btn-outline-success"><i class="ion ion-md-play"></i></button> <button type="button" class="flow-file-cancel btn btn-sm icon-btn btn-outline-danger"><i class="ion ion-md-close"></i></button></div></div></li>');var o=$(".flow-file-"+e.uniqueIdentifier);o.find(".flow-file-name").text(e.name),o.find(".flow-file-size").text(s(e.size)),o.find(".flow-file-download").attr("href","/download/"+e.uniqueIdentifier).hide(),o.find(".flow-file-pause").on("click",function(){e.pause(),o.find(".flow-file-pause").hide(),o.find(".flow-file-resume").show()}),o.find(".flow-file-resume").on("click",function(){e.resume(),o.find(".flow-file-pause").show(),o.find(".flow-file-resume").hide()}).hide(),o.find(".flow-file-cancel").on("click",function(){e.cancel(),o.remove()})}),i.on("filesSubmitted",function(){i.upload()}),i.on("complete",function(){$(".flow-progress .progress-resume-link, .flow-progress .progress-pause-link").hide()}),i.on("fileSuccess",function(e){var o=$(".flow-file-"+e.uniqueIdentifier);o.find(".flow-file-progress").text("(completed)"),o.find(".flow-file-pause, .flow-file-resume").remove(),o.find(".flow-file-download").attr("href","/download/"+e.uniqueIdentifier).show()}),i.on("fileError",function(e,o){$(".flow-file-"+e.uniqueIdentifier+" .flow-file-progress").addClass("text-danger").text("(file could not be uploaded: "+o+")")}),i.on("fileProgress",function(e){console.log(e.averageSpeed),$(".flow-file-"+e.uniqueIdentifier+" .flow-file-progress").html(Math.floor(100*e.progress())+"% "+s(e.averageSpeed)+"/s "+o(e.timeRemaining())+" remaining"),$(".flow-progress .progress-bar").css({width:Math.floor(100*i.progress())+"%"})}),i.on("uploadStart",function(){$(".flow-progress .progress-resume-link").hide(),$(".flow-progress .progress-pause-link").show()}),i.on("catchAll",function(){console.log.apply(console,arguments)}),window.r={pause:function(){i.pause(),$(".flow-file-resume").show(),$(".flow-file-pause").hide(),$(".flow-progress .progress-resume-link").show(),$(".flow-progress .progress-pause-link").hide()},cancel:function(){i.cancel(),$(".flow-progress .progress-resume-link").hide(),$(".flow-progress .progress-pause-link").hide(),$(".flow-progress .progress-bar").css({width:"0%"}),$(".flow-file").remove()},upload:function(){$(".flow-file-pause").show(),$(".flow-file-resume").hide(),i.resume()},flow:i}):$(".flow-error").show()});